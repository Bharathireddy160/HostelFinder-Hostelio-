<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hostel Details | Hostelio</title>
<style>
body { margin:0;font-family:'Segoe UI',sans-serif; background:url('images/bg.jpeg') no-repeat center center fixed; background-size:cover; color:#333; }
header{background:rgba(0,0,0,0.85);color:white;padding:15px 30px;display:flex;align-items:center;justify-content:space-between}
.logo{width:70px;height:70px;border-radius:50%;object-fit:cover}
.title{font-size:22px;font-weight:bold;color:#ffd700}
.nav a{color:white;margin-left:20px;text-decoration:none}
.nav a:hover{color:#ffd700}
main{max-width:900px;margin:30px auto;background:rgba(255,255,255,0.95);padding:20px;border-radius:10px;box-shadow:0 0 12px rgba(0,0,0,0.4)}
h1{color:#333;margin-bottom:10px}
.details p{margin:8px 0}
form{background:#f9f9f9;padding:20px;border-radius:8px;box-shadow:0 0 8px rgba(0,0,0,0.1);margin-top:20px}
label{display:block;margin-top:10px}
input,select{width:100%;padding:8px;margin-top:5px;border:1px solid #ccc;border-radius:5px}
button{margin-top:15px;padding:10px 18px;background:#ffd700;border:none;border-radius:6px;cursor:pointer;font-weight:bold}
button:hover{background:#e6c200}
</style>
</head>
<body>

<header>
<img src="images/ic.png" alt="Logo" class="logo">
<div class="title">Hostelio</div>
<div class="nav">
<a href="index.html">Home</a>
<a href="my_bookings.html">Bookings</a>
</div>
</header>

<main>
<h1 id="hostelName">Loading...</h1>
<div class="details">
<p><strong>Location:</strong> <span id="hostelLocation">Loading...</span></p>
<p><strong>Description:</strong> <span id="hostelDescription">Loading...</span></p>
<p><strong>Price:</strong> ₹<span id="hostelPrice">Loading...</span> / month</p>
<p><strong>Facilities:</strong> <span id="hostelFacilities">Loading...</span></p>
<p><strong>Contact:</strong> <span id="hostelContact">Loading...</span></p>
</div>

<h2>Book Now</h2>
<form id="bookingForm">
<label for="name">Full Name</label>
<input type="text" id="name" required />
<label for="email">Email</label>
<input type="email" id="email" required />
<label for="roomType">Room Type</label>
<select id="roomType" required>
<option value="">-- Select Room --</option>
<option value="Single">Single</option>
<option value="Double">Double</option>
<option value="Shared">Shared</option>
</select>
<button type="submit">Book Now</button>
</form>
</main>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyCLn45hIR-S75BEPypx1BFgOV8vA5MaqU0",
  authDomain:"hostelio-89130.firebaseapp.com",
  projectId:"hostelio-89130",
  storageBucket:"hostelio-89130.appspot.com",
  messagingSenderId:"530522106867",
  appId:"1:530522106867:web:227d355ea3fcc63317c086"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let hostelName = "";

// Load hostel details
async function loadHostelDetails(){
  const params = new URLSearchParams(window.location.search);
  const hostelId = params.get("id");
  if(!hostelId){alert("No hostel selected!"); return;}
  
  const hostelSnap = await db.collection("hostels").doc(hostelId).get();
  if(hostelSnap.exists){
    const data = hostelSnap.data();
    hostelName = data.name;
    document.getElementById("hostelName").textContent = data.name;
    document.getElementById("hostelLocation").textContent = data.location;
    document.getElementById("hostelDescription").textContent = data.description;
    document.getElementById("hostelPrice").textContent = data.price;
    document.getElementById("hostelFacilities").textContent = data.facilities || "Not specified";
    document.getElementById("hostelContact").textContent = data.contact || "Not available";
  } else { alert("Hostel not found!"); }
}
loadHostelDetails();

// Booking form
document.getElementById("bookingForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const roomType = document.getElementById("roomType").value;
  const params = new URLSearchParams(window.location.search);
  const hostelId = params.get("id");

  try{
    await db.collection("bookings").add({
      name,email,roomType,hostelId,hostel:hostelName,
      status:"pending",
      createdAt:firebase.firestore.FieldValue.serverTimestamp()
    });
    alert("✅ Booking request submitted! Please wait for admin approval.");
    document.getElementById("bookingForm").reset();
  }catch(err){
    console.error(err);
    alert("❌ Failed to submit booking. Try again.");
  }
});
</script>
</body>
</html>
