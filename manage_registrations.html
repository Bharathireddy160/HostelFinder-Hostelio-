<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Manage Registrations - Hostelio Admin</title>

<style>
  body {
    margin: 0; font-family: Arial, sans-serif;
    background: url('images/bg.jpeg') no-repeat center center fixed;
    background-size: cover; color: #333;
    display: flex; flex-direction: column; min-height: 100vh;
  }
  header {
    background: rgba(0,0,0,0.8); color: white;
    padding: 15px 30px; display: flex; justify-content: space-between; align-items: center;
  }
  .logo {
    width: 60px; height: 60px; border-radius: 50%; object-fit: cover;
  }
  .title { font-size: 24px; font-weight: bold; color: #ffd700; }
  .nav-links a {
    color: white; margin-left: 20px; text-decoration: none;
  }
  .nav-links a:hover { color: #ffd700; }

  main {
    flex: 1; max-width: 1100px; margin: 30px auto;
    background: #333; padding: 20px; border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.4); color: white;
  }
  h1 { text-align: center; margin-bottom: 20px; color: #ffd700; }

  /* Tabs */
  .tabs { display: flex; justify-content: center; margin-bottom: 20px; }
  .tab {
    padding: 10px 20px; margin: 0 5px;
    background: #444; color: white; border-radius: 6px;
    cursor: pointer; transition: 0.3s;
  }
  .tab.active { background: #ffd700; color: black; font-weight: bold; }

  table {
    width: 100%; border-collapse: collapse; background: white; color: black;
    border-radius: 8px; overflow: hidden;
  }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
  th { background: #ffd700; color: white; }
  tr:nth-child(even) { background-color: #f9f9f9; }

  button {
    margin-right: 5px; padding: 6px 12px; border: none; border-radius: 4px;
    cursor: pointer; transition: transform 0.2s, background 0.3s;
  }
  .accept { background: #28a745; color: white; }
  .accept:hover { background: #218838; transform: scale(1.05); }
  .reject { background: #dc3545; color: white; }
  .reject:hover { background: #c82333; transform: scale(1.05); }
  .delete { background: #6c757d; color: white; }
  .delete:hover { background: #5a6268; transform: scale(1.05); }

  footer {
    text-align: center; padding: 12px;
    background: rgba(0,0,0,0.8); color: white;
  }
</style>
</head>
<body>

<header>
  <img src="images/ic.png" alt="Logo" class="logo">
  <div class="title">Hostelio Admin</div>
  <div class="nav-links">
    <a href="admin_dashboard.html">Dashboard</a>
    <a href="admin_bookings.html">View Bookings</a>
    <a href="index.html">Logout</a>
  </div>
</header>

<main>
  <h1>Manage Registrations</h1>

  <!-- Tab Buttons -->
  <div class="tabs">
    <div class="tab active" onclick="showTab('pending')">Pending</div>
    <div class="tab" onclick="showTab('accepted')">Accepted</div>
    <div class="tab" onclick="showTab('rejected')">Rejected</div>
  </div>

  <!-- Tables -->
  <div id="pending" class="tab-content">
    <table id="pendingTable">
      <thead>
        <tr><th>Name</th><th>Email</th><th>Hostel</th><th>Room</th><th>Action</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="accepted" class="tab-content" style="display:none">
    <table id="acceptedTable">
      <thead>
        <tr><th>Name</th><th>Email</th><th>Hostel</th><th>Room</th><th>Date Accepted</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="rejected" class="tab-content" style="display:none">
    <table id="rejectedTable">
      <thead>
        <tr><th>Name</th><th>Email</th><th>Hostel</th><th>Room</th><th>Date Rejected</th><th>Action</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<footer>
  &copy; 2025 Hostelio. All rights reserved.
</footer>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { 
    getFirestore, collection, getDocs, setDoc, doc, deleteDoc 
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCLn45hIR-S75BEPypx1BFgOV8vA5MaqU0",
    authDomain: "hostelio-89130.firebaseapp.com",
    projectId: "hostelio-89130",
    storageBucket: "hostelio-89130.firebasestorage.app",
    messagingSenderId: "530522106867",
    appId: "1:530522106867:web:227d355ea3fcc63317c086"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function loadData() {
    loadTable("pendingRegistrations", "pendingTable", true);
    loadTable("acceptedRegistrations", "acceptedTable");
    loadTable("rejectedRegistrations", "rejectedTable", false, true);
  }

  async function loadTable(collectionName, tableId, withActions=false, withDelete=false) {
    const tbody = document.querySelector(`#${tableId} tbody`);
    tbody.innerHTML = "";

    const snapshot = await getDocs(collection(db, collectionName));
    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const tr = document.createElement("tr");

      if (collectionName === "pendingRegistrations") {
        tr.innerHTML = `
          <td>${data.name}</td>
          <td><a href="mailto:${data.email}" style="color:#007bff">${data.email}</a></td>
          <td>
            <a href="hostel_details.html?id=${data.hostelId}" target="_blank" style="color:#007bff; text-decoration:none;">
              ${data.hostel}
            </a>
          </td>
          <td>${data.roomType}</td>
          <td>
            <button class="accept">Accept</button>
            <button class="reject">Reject</button>
          </td>`;

        tr.querySelector(".accept").addEventListener("click", async () => {
          await setDoc(doc(db, "acceptedRegistrations", docSnap.id), { ...data, date: new Date().toISOString() });
          await deleteDoc(doc(db, "pendingRegistrations", docSnap.id));
          tr.remove();
          alert(`${data.name} accepted!`);
        });

        tr.querySelector(".reject").addEventListener("click", async () => {
          await setDoc(doc(db, "rejectedRegistrations", docSnap.id), { ...data, date: new Date().toISOString() });
          await deleteDoc(doc(db, "pendingRegistrations", docSnap.id));
          tr.remove();
          alert(`${data.name} rejected!`);
        });
      }
      else if (collectionName === "acceptedRegistrations") {
        tr.innerHTML = `
          <td>${data.name}</td>
          <td><a href="mailto:${data.email}" style="color:#007bff">${data.email}</a></td>
          <td>
            <a href="hostel_details.html?id=${data.hostelId}" target="_blank" style="color:#007bff; text-decoration:none;">
              ${data.hostel}
            </a>
          </td>
          <td>${data.roomType}</td>
          <td>${data.date || "-"}</td>`;
      }
      else if (collectionName === "rejectedRegistrations") {
        tr.innerHTML = `
          <td>${data.name}</td>
          <td><a href="mailto:${data.email}" style="color:#007bff">${data.email}</a></td>
          <td>
            <a href="hostel_details.html?id=${data.hostelId}" target="_blank" style="color:#007bff; text-decoration:none;">
              ${data.hostel}
            </a>
          </td>
          <td>${data.roomType}</td>
          <td>${data.date || "-"}</td>
          <td><button class="delete">Delete</button></td>`;

        tr.querySelector(".delete").addEventListener("click", async () => {
          await deleteDoc(doc(db, "rejectedRegistrations", docSnap.id));
          tr.remove();
          alert(`${data.name} deleted permanently!`);
        });
      }

      tbody.appendChild(tr);
    });
  }

  // Tab switching
  window.showTab = function(tabId) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c => c.style.display = "none");
    document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add("active");
    document.getElementById(tabId).style.display = "block";
    loadData();
  };

  document.addEventListener("DOMContentLoaded", loadData);
</script>
</body>
</html>
