<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Reports & Analytics - Hostelio Admin</title>
<style>
  body {
    margin: 0; font-family: Arial, sans-serif;
    background: url('images/bg.jpeg') no-repeat center center fixed;
    background-size: cover; color: white;
    display: flex; flex-direction: column; min-height: 100vh;
  }
  header {
    display: flex; justify-content: space-between; align-items: center;
    padding: 15px 30px; background: rgba(0,0,0,0.8);
  }
  .title { font-size: 24px; font-weight: bold; color: #ffd700; }
  .nav-links a {
    color: white; text-decoration: none; margin-left: 20px; font-size: 16px;
    transition: color 0.3s;
  }
  .nav-links a:hover { color: #ffd700; }
  main {
    flex: 1; padding: 40px; display: flex; flex-direction: column; align-items: center;
  }
  h1 { margin-bottom: 20px; font-size: 36px; color: #ffd700; text-align: center; }
  .charts { display: flex; flex-wrap: wrap; justify-content: center; gap: 40px; margin-top: 20px; }
  .chart-container { background: rgba(0,0,0,0.7); padding: 20px; border-radius: 12px; width: 400px; }
  canvas { background: white; border-radius: 8px; }
  .logo {
      width: 70px; height: 70px;
      border-radius: 50%; object-fit: cover;
    }
</style>
</head>
<body>
<header>
  <div class="left-section">
    <img src="images/ic.png" alt="Logo" class="logo">
  </div>
  <div class="title">Hostelio Admin</div>
  <div class="nav-links">
    <a href="admin_home.html">Home</a>
    <a href="admin_dashboard.html">Admin Dashboard</a>
    <a href="index.html" onclick="logout()">Logout</a>
  </div>
</header>

<main>
  <h1>Reports & Analytics</h1>
  <div class="charts">
    <div class="chart-container">
      <h3>Pending vs Accepted vs Rejected</h3>
      <canvas id="registrationStatusChart"></canvas>
    </div>
    <div class="chart-container">
      <h3>Top Hostels by Bookings</h3>
      <canvas id="topHostelsChart"></canvas>
    </div>
  </div>
</main>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCLn45hIR-S75BEPypx1BFgOV8vA5MaqU0",
    authDomain: "hostelio-89130.firebaseapp.com",
    databaseURL: "https://hostelio-89130-default-rtdb.firebaseio.com",
    projectId: "hostelio-89130",
    storageBucket: "hostelio-89130.firebasestorage.app",
    messagingSenderId: "530522106867",
    appId: "1:530522106867:web:227d355ea3fcc63317c086",
    measurementId: "G-CYM1EHN5G5"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function loadAnalytics() {
    const snapshot = await getDocs(collection(db, "bookings"));

    let pending = 0, accepted = 0, rejected = 0;
    const hostelCounts = {};

    snapshot.forEach(doc => {
      const data = doc.data();
      const status = data.status || "pending"; // default
      const hostel = data.hostelName || data.hostelId || "Unknown Hostel";

      // Status count
      if (status === "pending") pending++;
      else if (status === "accepted") accepted++;
      else if (status === "rejected") rejected++;

      // Hostel count
      hostelCounts[hostel] = (hostelCounts[hostel] || 0) + 1;
    });

    // Pie Chart for Status
    new Chart(document.getElementById("registrationStatusChart"), {
      type: 'pie',
      data: {
        labels: ['Pending', 'Accepted', 'Rejected'],
        datasets: [{
          data: [pending, accepted, rejected],
          backgroundColor: ['#ffc107', '#28a745', '#dc3545']
        }]
      },
      options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
    });

    // Bar Chart for Hostels
    new Chart(document.getElementById("topHostelsChart"), {
      type: 'bar',
      data: {
        labels: Object.keys(hostelCounts),
        datasets: [{
          label: 'Total Bookings',
          data: Object.values(hostelCounts),
          backgroundColor: '#ffd700'
        }]
      },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });
  }

  loadAnalytics();

  function logout() {
    localStorage.removeItem("username");
  }
</script>
</body>
</html>
